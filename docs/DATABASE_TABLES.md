# Fortune Flutter App - Supabase ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ë¬¸ì„œ

ì´ ë¬¸ì„œëŠ” Fortune Flutter ì•±ì—ì„œ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  Supabase ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì„ ì •ë¦¬í•œ ê²ƒì…ë‹ˆë‹¤.

## ğŸ“‹ í…Œì´ë¸” ëª©ë¡

### 1. ğŸ§‘â€ğŸ¤â€ğŸ§‘ ì‚¬ìš©ì ê´€ë ¨ í…Œì´ë¸”

#### `user_profiles` (ì‚¬ìš©ì í”„ë¡œí•„)
- **ìœ„ì¹˜**: Supabase Authì™€ ì—°ë™ (auth.users ì°¸ì¡°)
- **ìš©ë„**: ì‚¬ìš©ì í”„ë¡œí•„ ì •ë³´ ì €ì¥
- **ì„œë¹„ìŠ¤**: `lib/services/phone_auth_service.dart`, `lib/services/social_auth_service.dart`
- **ì£¼ìš” í•„ë“œ**:
  - user_id (auth.users ì°¸ì¡°)
  - í”„ë¡œí•„ ì •ë³´ (ì´ë¦„, ìƒë…„ì›”ì¼, ì„±ë³„ ë“±)
- **RLS**: âœ… ì ìš©ë¨ (ì‚¬ìš©ì ë³¸ì¸ë§Œ ì ‘ê·¼ ê°€ëŠ¥)

#### `pets` (ë°˜ë ¤ë™ë¬¼ í”„ë¡œí•„) âœ… **í™•ì¸ë¨**
- **ìœ„ì¹˜**: `lib/services/pet_service.dart`ì—ì„œ ì‚¬ìš©
- **ìš©ë„**: ì‚¬ìš©ìì˜ ë°˜ë ¤ë™ë¬¼ ì •ë³´ ì €ì¥
- **ëª¨ë¸**: `lib/data/models/pet_profile.dart`
- **ì£¼ìš” í•„ë“œ**:
  - id (UUID)
  - user_id (ì‚¬ìš©ì ì°¸ì¡°)
  - name (ë°˜ë ¤ë™ë¬¼ ì´ë¦„)
  - species (ë™ë¬¼ ì¢…ë¥˜)
  - age (ë‚˜ì´)
  - created_at, updated_at
- **RLS**: âœ… ì ìš©ë¨ (ì‚¬ìš©ì ë³¸ì¸ì˜ ë°˜ë ¤ë™ë¬¼ë§Œ ì ‘ê·¼)

#### `user_statistics` (ì‚¬ìš©ì í†µê³„)
- **ìœ„ì¹˜**: `lib/services/user_statistics_service.dart`
- **ìš©ë„**: ì‚¬ìš©ì í™œë™ í†µê³„ ì €ì¥
- **ì£¼ìš” í•„ë“œ**: ìš´ì„¸ ì¡°íšŒ íšŸìˆ˜, í™œë™ ë¡œê·¸ ë“±

### 2. ğŸ­ ìœ ëª…ì¸ ê´€ë ¨ í…Œì´ë¸”

#### `celebrities` (ìœ ëª…ì¸ ì •ë³´)
- **ìœ„ì¹˜**: `lib/services/celebrity_supabase_service.dart`, `lib/services/celebrity_service_new.dart`
- **ë§ˆì´ê·¸ë ˆì´ì…˜**:
  - `20250119000002_create_new_celebrity_schema.sql`
  - `20250828000002_create_accurate_celebrities_table.sql`
- **ìš©ë„**: ìœ ëª…ì¸ ê¸°ë³¸ ì •ë³´ ë° ì‚¬ì£¼ ë°ì´í„°
- **ì£¼ìš” í•„ë“œ**:
  - id, name, birth_date, zodiac_sign
  - saju_data (ì‚¬ì£¼ ì •ë³´)
  - category (ì§ì—… ë¶„ë¥˜)
- **ë°±ì—…**: `celebrities_backup` í…Œì´ë¸”ë¡œ ê¸°ì¡´ ë°ì´í„° ë³´ê´€

#### `celebrity_master_list` (ìœ ëª…ì¸ ë§ˆìŠ¤í„° ë¦¬ìŠ¤íŠ¸)
- **ë§ˆì´ê·¸ë ˆì´ì…˜**: `20250826000004_create_celebrity_master_list.sql`
- **ìš©ë„**: ìœ ëª…ì¸ í†µí•© ê´€ë¦¬ ëª©ë¡

### 3. ğŸ”® ìš´ì„¸ ê´€ë ¨ í…Œì´ë¸”

#### `fortune_cache` (ìš´ì„¸ ìºì‹œ)
- **ìœ„ì¹˜**: `lib/services/cache_service.dart`
- **ë§ˆì´ê·¸ë ˆì´ì…˜**: `create_fortune_cache_tables.sql`
- **ìš©ë„**: ìš´ì„¸ ê²°ê³¼ ìºì‹±ìœ¼ë¡œ ì„±ëŠ¥ ìµœì í™”
- **ì£¼ìš” í•„ë“œ**:
  - user_id, fortune_type, cache_data
  - expires_at (ë§Œë£Œ ì‹œê°„)

#### `fortune_stories` (ìš´ì„¸ ìŠ¤í† ë¦¬)
- **ìœ„ì¹˜**: `lib/services/cache_service.dart`
- **ë§ˆì´ê·¸ë ˆì´ì…˜**: `create_fortune_cache_tables.sql`
- **ìš©ë„**: ìƒì„±ëœ ìš´ì„¸ ìŠ¤í† ë¦¬ ì €ì¥

#### `fortune_history` (ìš´ì„¸ ê¸°ë¡)
- **ìœ„ì¹˜**: `lib/services/fortune_history_service.dart`
- **ë§ˆì´ê·¸ë ˆì´ì…˜**: `20250829000001_create_fortune_history_table.sql`
- **ìš©ë„**: ì‚¬ìš©ìë³„ ìš´ì„¸ ì¡°íšŒ ì´ë ¥ ê´€ë¦¬
- **ì£¼ìš” í•„ë“œ**:
  - user_id, fortune_type, fortune_date
  - result_data (ìš´ì„¸ ê²°ê³¼)

### 4. ğŸ§¿ ë¶€ì  ê´€ë ¨ í…Œì´ë¸”

#### `user_talismans` (ì‚¬ìš©ì ë¶€ì )
- **ìœ„ì¹˜**: `lib/features/talisman/data/services/talisman_service.dart`
- **ë§ˆì´ê·¸ë ˆì´ì…˜**: `20250825000001_create_talisman_tables.sql`
- **ìš©ë„**: ì‚¬ìš©ìê°€ ë³´ìœ í•œ ë¶€ì  ì •ë³´
- **ì£¼ìš” í•„ë“œ**:
  - user_id, talisman_type, obtained_at
  - is_active (í™œì„±í™” ìƒíƒœ)

#### `talisman_effects` (ë¶€ì  íš¨ê³¼)
- **ìœ„ì¹˜**: `lib/features/talisman/data/services/talisman_service.dart`
- **ë§ˆì´ê·¸ë ˆì´ì…˜**: `20250825000001_create_talisman_tables.sql`
- **ìš©ë„**: ë¶€ì ë³„ íš¨ê³¼ ë° ì˜í–¥ë ¥ ê´€ë¦¬

### 5. ğŸ“… ë‚ ì§œ ê´€ë ¨ í…Œì´ë¸”

#### `korean_holidays` (í•œêµ­ ê³µíœ´ì¼)
- **ë§ˆì´ê·¸ë ˆì´ì…˜**: `20240820000001_create_korean_holidays.sql`
- **ìš©ë„**: í•œêµ­ ê³µíœ´ì¼ ì •ë³´ ì €ì¥
- **ì„œë¹„ìŠ¤**: `lib/core/services/holiday_service.dart`

#### `auspicious_days` (ê¸¸ì¼ ì •ë³´)
- **ë§ˆì´ê·¸ë ˆì´ì…˜**: `20240820000001_create_korean_holidays.sql`
- **ìš©ë„**: ìŒë ¥ ê¸¸ì¼ ë° í‰ì¼ ì •ë³´

#### `popular_regions` (ì¸ê¸° ì§€ì—­)
- **ë§ˆì´ê·¸ë ˆì´ì…˜**: `20250829000002_create_popular_regions_table.sql`
- **ìš©ë„**: ì§€ì—­ë³„ ì¸ê¸°ë„ í†µê³„

### 6. ğŸ“ ê¸°íƒ€ í…Œì´ë¸”

#### `todos` (í• ì¼ ê´€ë¦¬)
- **ìœ„ì¹˜**: `lib/data/repositories/todo_repository_impl.dart`
- **ë§ˆì´ê·¸ë ˆì´ì…˜**: `create_todos_table.sql`
- **ìš©ë„**: ì‚¬ìš©ì í• ì¼ ê´€ë¦¬ (ì„ íƒì  ê¸°ëŠ¥)

#### `migration_log` (ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡œê·¸)
- **ë§ˆì´ê·¸ë ˆì´ì…˜**: `20250119000004_create_indexes_and_functions.sql`
- **ìš©ë„**: ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ë ¥ ì¶”ì 

#### `crawling_logs` (í¬ë¡¤ë§ ë¡œê·¸)
- **ë§ˆì´ê·¸ë ˆì´ì…˜**: `20250826000003_add_crawling_metadata.sql`
- **ìš©ë„**: ìœ ëª…ì¸ ë°ì´í„° í¬ë¡¤ë§ ì´ë ¥ ê´€ë¦¬

## ğŸ” ë³´ì•ˆ ë° ê¶Œí•œ

### RLS (Row Level Security) ì ìš© í…Œì´ë¸”
- `user_profiles`: ì‚¬ìš©ì ë³¸ì¸ë§Œ ì ‘ê·¼
- `pets`: ì‚¬ìš©ì ë³¸ì¸ì˜ ë°˜ë ¤ë™ë¬¼ë§Œ ì ‘ê·¼
- `user_talismans`: ì‚¬ìš©ì ë³¸ì¸ì˜ ë¶€ì ë§Œ ì ‘ê·¼
- `fortune_history`: ì‚¬ìš©ì ë³¸ì¸ì˜ ìš´ì„¸ ê¸°ë¡ë§Œ ì ‘ê·¼
- `user_statistics`: ì‚¬ìš©ì ë³¸ì¸ì˜ í†µê³„ë§Œ ì ‘ê·¼

### ê³µê°œ í…Œì´ë¸” (RLS ë¯¸ì ìš©)
- `celebrities`: ëª¨ë“  ì‚¬ìš©ìê°€ ì½ê¸° ê°€ëŠ¥
- `korean_holidays`: ëª¨ë“  ì‚¬ìš©ìê°€ ì½ê¸° ê°€ëŠ¥
- `auspicious_days`: ëª¨ë“  ì‚¬ìš©ìê°€ ì½ê¸° ê°€ëŠ¥
- `popular_regions`: ëª¨ë“  ì‚¬ìš©ìê°€ ì½ê¸° ê°€ëŠ¥

## ğŸ“Š í…Œì´ë¸” ê´€ê³„ë„

```
auth.users (Supabase Auth)
    â”œâ”€â”€ user_profiles (1:1)
    â”œâ”€â”€ pets (1:N)
    â”œâ”€â”€ user_talismans (1:N)
    â”œâ”€â”€ fortune_history (1:N)
    â”œâ”€â”€ fortune_cache (1:N)
    â”œâ”€â”€ user_statistics (1:1)
    â””â”€â”€ todos (1:N)

celebrities (ë…ë¦½)
    â””â”€â”€ celebrity_master_list (ê´€ë ¨)

korean_holidays (ë…ë¦½)
auspicious_days (ë…ë¦½)
popular_regions (ë…ë¦½)
```

## ğŸš¨ ì¤‘ìš” ì‚¬í•­

### âš ï¸ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ìƒì„± ì „ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
**ìƒˆë¡œìš´ í…Œì´ë¸”ì„ ë§Œë“¤ê¸° ì „ì— ë°˜ë“œì‹œ í™•ì¸í•´ì•¼ í•  ì‚¬í•­ë“¤:**

1. **ê¸°ì¡´ í…Œì´ë¸” ì¡´ì¬ ì—¬ë¶€ í™•ì¸**
   - ì´ ë¬¸ì„œ (`docs/DATABASE_TABLES.md`) ë¨¼ì € í™•ì¸
   - ì½”ë“œì—ì„œ í…Œì´ë¸” ì‚¬ìš© ì—¬ë¶€ ê²€ìƒ‰: `grep -r "í…Œì´ë¸”ëª…" lib/`
   - ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì—ì„œ í…Œì´ë¸” ìƒì„± ì´ë ¥ í™•ì¸
   - ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ í…Œì´ë¸” ì¡´ì¬ í™•ì¸

2. **í…Œì´ë¸” êµ¬ì¡° ë¶„ì„**
   - ê¸°ì¡´ ì½”ë“œì˜ ëª¨ë¸ í´ë˜ìŠ¤ í™•ì¸
   - ì„œë¹„ìŠ¤ íŒŒì¼ì—ì„œ ì‚¬ìš©í•˜ëŠ” í•„ë“œ í™•ì¸
   - RLS ì •ì±… ë° ì¸ë±ìŠ¤ ìš”êµ¬ì‚¬í•­ íŒŒì•…

3. **ì¤‘ë³µ ìƒì„± ë°©ì§€**
   - ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ì¤‘ë³µ ìƒì„± ê¸ˆì§€
   - ê¸°ì¡´ í…Œì´ë¸”ê³¼ ì¶©ëŒí•˜ì§€ ì•ŠëŠ”ì§€ í™•ì¸

### pets í…Œì´ë¸” í™•ì¸ë¨ âœ…
- **ì‚¬ìš©ì í™•ì¸**: "íŒ»í…Œì´ë¸”ì€ ì´ë¯¸ ìˆì–´"
- **ì½”ë“œ í™•ì¸**: `lib/services/pet_service.dart`ì—ì„œ 'pets' í…Œì´ë¸” ì‚¬ìš©
- **ëª¨ë¸ í™•ì¸**: `lib/data/models/pet_profile.dart`ì— PetProfile í´ë˜ìŠ¤ ì •ì˜
- **ìƒíƒœ**: í…Œì´ë¸”ì´ ì‹¤ì œ ì¡´ì¬í•˜ë©° ì½”ë“œì™€ ì—°ë™ë¨
- **êµí›ˆ**: í…Œì´ë¸” ìƒì„± ì „ ê¸°ì¡´ ì¡´ì¬ ì—¬ë¶€ í™•ì¸ í•„ìˆ˜!

### ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ê´€ë¦¬
- ëª¨ë“  í…Œì´ë¸”ì€ `supabase/migrations/` ë””ë ‰í† ë¦¬ì˜ SQL íŒŒì¼ë¡œ ê´€ë¦¬
- íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜ ìˆœì°¨ ì‹¤í–‰ (YYYYMMDD_HHMMSS í˜•ì‹)
- ë°±ì—… í…Œì´ë¸”ì„ í†µí•œ ì•ˆì „í•œ ìŠ¤í‚¤ë§ˆ ë³€ê²½

### ìŠ¤í† ë¦¬ì§€ ë²„í‚· ë° ì •ì±… âœ… **í•´ê²°ë¨**
- **ìŠ¤í† ë¦¬ì§€ ë²„í‚·**: `profile-images` (í”„ë¡œí•„ ì´ë¯¸ì§€ ì €ì¥)
- **ë§ˆì´ê·¸ë ˆì´ì…˜**: `20250929130000_create_storage_buckets_and_policies.sql`
- **ì •ì±…**:
  - ì‚¬ìš©ì ë³¸ì¸ì˜ í´ë”ì—ë§Œ ì—…ë¡œë“œ/ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥
  - ëª¨ë“  ì‚¬ìš©ìê°€ í”„ë¡œí•„ ì´ë¯¸ì§€ ì¡°íšŒ ê°€ëŠ¥ (public bucket)
  - íŒŒì¼ í¬ê¸° ì œí•œ: 5MB
  - í—ˆìš© í˜•ì‹: JPEG, PNG, WebP
- **ê¶Œí•œ ê²€ì¦**: `SupabaseStorageService.ensureBucketExists()`ì—ì„œ ì‹¤ì‹œê°„ ê¶Œí•œ í™•ì¸

### ìºì‹± ì „ëµ
- `fortune_cache`: ìš´ì„¸ ê²°ê³¼ ìºì‹±ìœ¼ë¡œ API í˜¸ì¶œ ìµœì†Œí™”
- `fortune_stories`: ìƒì„±ëœ ìŠ¤í† ë¦¬ ì¬ì‚¬ìš©ìœ¼ë¡œ ì„±ëŠ¥ í–¥ìƒ

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-09-29
**ì‘ì„±ì**: Claude Code
**ëª©ì **: ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ì¶”ì  ë° ê´€ë¦¬ ìš©ì´ì„± í™•ë³´