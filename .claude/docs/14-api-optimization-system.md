# API í˜¸ì¶œ ìµœì í™” ì‹œìŠ¤í…œ

> ìµœì¢… ì—…ë°ì´íŠ¸: 2026.01.04
> ì¸ì‚¬ì´íŠ¸ë³„ API í˜¸ì¶œ ë¡œì§, ìºì‹œ ì „ëµ, ë¹„ìš© ë¶„ì„ ë¬¸ì„œ
>
> **NEW: Cohort Pool ì‹œìŠ¤í…œ ì¶”ê°€ (API ë¹„ìš© 90% ì ˆê° ëª©í‘œ)**

---

## ğŸš€ Cohort Pool ì‹œìŠ¤í…œ (ì‹ ê·œ)

### í•µì‹¬ ê°œë…

**ë¬¸ì œ**: ê¸°ì¡´ conditions_hash ì¡°í•© ìˆ˜ê°€ ìš´ì„¸ë³„ë¡œ ìˆ˜ì²œ~ë¬´í•œëŒ€
**í•´ê²°**: "ì¼ë°˜í™” ê°€ëŠ¥ í•„ë“œ"ë§Œìœ¼ë¡œ cohort ì •ì˜ â†’ ì¡°í•© ìˆ˜ 100~1000ê°œë¡œ ì œí•œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ì¸ì‚¬ì´íŠ¸ ì¡°íšŒ ìš”ì²­                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸš€ NEW: Cohort Pool ì¡°íšŒ                                        â”‚
â”‚     - ë‚˜ì‡ëŒ€ + ë  + ì˜¤í–‰ ë“± ì¼ë°˜í™”ëœ cohort ì¶”ì¶œ                     â”‚
â”‚     - cohort_fortune_poolì—ì„œ ëœë¤ ê²°ê³¼ ì„ íƒ                        â”‚
â”‚     - í”Œë ˆì´ìŠ¤í™€ë” ê°œì¸í™” ({{userName}} â†’ ì‹¤ì œ ì´ë¦„)                  â”‚
â”‚     âœ… API í˜¸ì¶œ ìƒëµ (90% ì ˆê°!)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ Pool ì—†ìŒ (ì´ˆê¸°ë§Œ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âŒ LLM API í˜¸ì¶œ (Pool êµ¬ì¶• ì „ë§Œ)                                   â”‚
â”‚     - generate-cohort-pool ë°°ì¹˜ë¡œ ì‚¬ì „ ìƒì„±                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Cohort ì •ì˜ ì›ì¹™

#### Tier 1: í•´ì‹œì—ì„œ ì œì™¸ (ê°œì¸ ê³ ìœ  â†’ ë¬´í•œ ì¡°í•©)
| í•„ë“œ | ì œì™¸ ì´ìœ  |
|------|----------|
| `userName` | ì¤‘ë³µ ê±°ì˜ ì—†ìŒ |
| `birthDate` (ì •í™•í•œ ë‚ ì§œ) | 36,500ê°œ ì¡°í•© â†’ ë‚˜ì‡ëŒ€ë¡œ ëŒ€ì²´ |
| `birthTime` | 12ê°œ ì‹œì§„ â†’ ì˜¤í–‰ìœ¼ë¡œ ëŒ€ì²´ |
| `userId` | ê°œì¸ ì‹ë³„ìš© |

#### Tier 2: í•´ì‹œì— í¬í•¨ (ì¼ë°˜í™”ëœ í˜•íƒœ)
| í•„ë“œ | ë³€í™˜ ë°©ì‹ | ì¡°í•© ìˆ˜ |
|------|----------|--------|
| `ageGroup` | 10ëŒ€/20ëŒ€/30ëŒ€/40ëŒ€/50ëŒ€+ | 5ê°œ |
| `gender` | ë‚¨/ì—¬/ê¸°íƒ€ | 3ê°œ |
| `relationshipStatus` | ì†”ë¡œ/ì¸/ì—°ì• /ê¸°í˜¼ | 4ê°œ |
| `zodiac` (ë ) | 12ì§€ì§€ | 12ê°œ |
| `element` (ì˜¤í–‰) | ëª©í™”í† ê¸ˆìˆ˜ | 5ê°œ |

### ìš´ì„¸ë³„ Cohort ì„¤ê³„

| ì¸ì‚¬ì´íŠ¸ íƒ€ì… | Cohort ì°¨ì› | ì¡°í•© ìˆ˜ | Pool í¬ê¸° | ì´ ê²°ê³¼ ìˆ˜ |
|-------------|------------|--------|----------|----------|
| **Daily** | period Ã— zodiac Ã— element | 5Ã—12Ã—5 = **300** | 50 | 15,000 |
| **Love** | ageGroup Ã— gender Ã— status Ã— zodiac | 5Ã—3Ã—4Ã—12 = **720** | 50 | 36,000 |
| **Compatibility** | zodiac1 Ã— zodiac2 Ã— genderPair | 12Ã—12Ã—3 = **432** | 50 | 21,600 |
| **Career** | ageGroup Ã— gender Ã— industry | 5Ã—3Ã—10 = **150** | 50 | 7,500 |
| **Health** | ageGroup Ã— gender Ã— season Ã— element | 5Ã—3Ã—4Ã—5 = **300** | 50 | 15,000 |
| **MBTI** | mbti | **16** | 50 | 800 |
| **Dream** | dreamCategory Ã— emotion Ã— zodiac | 10Ã—5Ã—12 = **600** | 50 | 30,000 |
| **Face Reading** | faceShape Ã— gender Ã— ageGroup | 8Ã—3Ã—5 = **120** | 50 | 6,000 |
| **Talent** | ageGroup Ã— gender Ã— talentArea | 5Ã—3Ã—8 = **120** | 50 | 6,000 |
| **Investment** | ageGroup Ã— riskTolerance Ã— element | 5Ã—3Ã—5 = **75** | 50 | 3,750 |
| **Ex-lover** | emotionState Ã— timeElapsed Ã— contactStatus | 5Ã—4Ã—3 = **60** | 50 | 3,000 |
| **Blind Date** | ageGroup Ã— gender Ã— dateGoal | 5Ã—3Ã—3 = **45** | 50 | 2,250 |

**ì´ Cohort**: ~3,200ê°œ | **ì´ ê²°ê³¼**: ~160,000ê°œ

### ë¹„ìš© ì ˆê° ì˜ˆìƒ (DAU 1,000ëª…)

| í•­ëª© | í˜„ì¬ | Cohort Pool ì ìš© í›„ |
|------|------|---------------------|
| ì¼ì¼ API í˜¸ì¶œ | 1,400íšŒ | **140íšŒ** |
| ì›”ê°„ API í˜¸ì¶œ | 42,000íšŒ | **4,200íšŒ** |
| ì›”ê°„ ë¹„ìš© | $420 | **$42** |
| **ì ˆê°ì•¡** | - | **$378 (90%)** |

### ê´€ë ¨ íŒŒì¼

**DB í…Œì´ë¸”**:
- `cohort_fortune_pool` - ì‚¬ì „ ìƒì„±ëœ ìš´ì„¸ ê²°ê³¼ ì €ì¥
- `cohort_pool_settings` - ìš´ì„¸ë³„ cohort ì„¤ì •

**Edge Functions**:
- `generate-cohort-pool` - ë°°ì¹˜ ìƒì„± Edge Function

**Flutter Services**:
- [cohort_fortune_service.dart](lib/core/services/cohort_fortune_service.dart) - Cohort ì¡°íšŒ/ì €ì¥
- [cohort_helpers.dart](lib/core/utils/cohort_helpers.dart) - ë‚˜ì‡ëŒ€/ë /ì˜¤í–‰ í—¬í¼

**Edge Function Utilities**:
- `_shared/cohort/index.ts` - Edge Functionìš© cohort ìœ í‹¸ë¦¬í‹°

---

## 1. ê¸°ì¡´ ì‹œìŠ¤í…œ ê°œìš” (ë ˆê±°ì‹œ)

### 1.1 ìµœì í™” ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ì¸ì‚¬ì´íŠ¸ ì¡°íšŒ ìš”ì²­                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1ï¸âƒ£ ê°œì¸ ìºì‹œ í™•ì¸ (fortune_results)                              â”‚
â”‚     - ì˜¤ëŠ˜ + ë™ì¼ ì¡°ê±´ í•´ì‹œ ì¡°íšŒ                                    â”‚
â”‚     - íˆíŠ¸: 50% í™•ë¥  ê´‘ê³  â†’ ì¦‰ì‹œ ë°˜í™˜                              â”‚
â”‚     âœ… API í˜¸ì¶œ ìƒëµ                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ ë¯¸ìŠ¤
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2ï¸âƒ£ DB í’€ í¬ê¸° í™•ì¸                                               â”‚
â”‚     - ë™ì¼ í•´ì‹œ ë°ì´í„° 300ê°œ ì´ìƒ?                                  â”‚
â”‚     - ì¶©ì¡±: ëœë¤ ì„ íƒ â†’ 5ì´ˆ ëŒ€ê¸° â†’ ë°˜í™˜                            â”‚
â”‚     âœ… API í˜¸ì¶œ ìƒëµ                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ ë¯¸ë‹¬
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3ï¸âƒ£ 30% ëœë¤ ì„ íƒ                                                 â”‚
â”‚     - 30% í™•ë¥  ë‹¹ì²¨ ì‹œ: ìµœê·¼ 100ê°œ ì¤‘ ëœë¤ ì„ íƒ                    â”‚
â”‚     âœ… API í˜¸ì¶œ ìƒëµ                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ ë¯¸ë‹¹ì²¨ (70%)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4ï¸âƒ£-6ï¸âƒ£ API í˜¸ì¶œ                                                  â”‚
â”‚     - ê´‘ê³  í‘œì‹œ (5ì´ˆ)                                              â”‚
â”‚     - Edge Function í˜¸ì¶œ                                          â”‚
â”‚     - ê²°ê³¼ DB ì €ì¥                                                 â”‚
â”‚     âŒ API í˜¸ì¶œ ë°œìƒ                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 í•µì‹¬ ìƒìˆ˜

**íŒŒì¼**: `lib/core/services/fortune_optimization_service.dart`

```dart
static const int dbPoolThreshold = 300;           // DB í’€ ìµœì†Œ í¬ê¸°
static const double randomSelectionProbability = 0.3;  // 30% í™•ë¥ 
static const double personalCacheAdProbability = 0.5;  // ê°œì¸ ìºì‹œ 50% ê´‘ê³ 
static const Duration delayDuration = Duration(seconds: 5);  // 5ì´ˆ ëŒ€ê¸°
```

---

## 2. ì¸ì‚¬ì´íŠ¸ë³„ í•´ì‹œ êµ¬ì„± ë¶„ì„

### 2.1 íš¨ìœ¨ì„± ë¶„ë¥˜

| ë“±ê¸‰ | ì¡°í•© ìˆ˜ | 300ê°œ ë„ë‹¬ ê°€ëŠ¥ì„± | ìš´ì„¸ íƒ€ì… |
|------|---------|-----------------|----------|
| ğŸŸ¢ **ë§¤ìš° íš¨ìœ¨** | 1-20 | ë¹ ë¦„ (ìˆ˜ì²œ íšŒ) | MBTI, í˜ˆì•¡í˜• |
| ğŸŸ¡ **íš¨ìœ¨** | 20-200 | ì¤‘ê°„ (ìˆ˜ë§Œ íšŒ) | Daily (ì§ˆë¬¸ ì œì™¸), ê°€ì¡± |
| ğŸŸ  **ë¹„íš¨ìœ¨** | 200-10,000 | ëŠë¦¼ (ìˆ˜ì‹­ë§Œ íšŒ) | Personality DNA, Ex-lover |
| ğŸ”´ **ë§¤ìš° ë¹„íš¨ìœ¨** | 10,000+ | ë¶ˆê°€ëŠ¥ | Love, Compatibility, Dream, ê´€ìƒ |

### 2.2 ìƒì„¸ ë¶„ì„í‘œ

| ì¸ì‚¬ì´íŠ¸ íƒ€ì… | í•´ì‹œ êµ¬ì„± | ë³€ìˆ˜ | ì¡°í•© ìˆ˜ | 300ê°œ ë„ë‹¬ API íšŸìˆ˜ |
|----------|----------|------|---------|-------------------|
| **MBTI** | `mbti:${hashCode}` | MBTI 16ì¢… | **16** | 4,800 |
| **Biorhythm** | `birthDate:${hashCode}` | ìƒë…„ì›”ì¼ | **~36,500** | 10,950,000 |
| **Personality DNA** | `mbti\|blood\|zodiac\|animal` | 16Ã—4Ã—12Ã—12 | **9,216** | 2,764,800 |
| **Daily** | `period\|category\|emotion\|q` | 5Ã—5Ã—5Ã—âˆ | **âˆ (ì§ˆë¬¸)** | ë¬´í•œ |
| **Daily (ì§ˆë¬¸ ì œì™¸)** | `period\|category\|emotion` | 5Ã—5Ã—5 | **125** | 37,500 |
| **Love** | ë³µí•© (13ê°œ í•„ë“œ) | ìˆ˜ë°±ë§Œ | **âˆ** | ë¬´í•œ |
| **Compatibility** | `p1\|bd1\|p2\|bd2` | ì´ë¦„Ã—ìƒì¼Â² | **âˆ** | ë¬´í•œ |
| **Ex-lover** | `emotion\|time\|curiosity\|initiator\|contact` | 5Ã—5Ã—5Ã—2Ã—3 | **750** | 225,000 |
| **Talent** | `birth\|gender\|concerns\|interests\|style` | ë³µí•© | **ìˆ˜ì²œ** | ìˆ˜ë°±ë§Œ |
| **Dream** | `dream:${hashCode}\|date` | ê¿ˆë‚´ìš©Ã—ë‚ ì§œ | **âˆ** | ë¬´í•œ |
| **Face Reading** | `img:${hash}\|gender\|age` | ì´ë¯¸ì§€Ã—ì„±ë³„Ã—ë‚˜ì´ | **âˆ** | ë¬´í•œ |
| **Moving** | `current\|target\|period\|purpose` | ë³µí•© | **ìˆ˜ë°±** | ìˆ˜ë§Œ |
| **Health** | `concern\|symptoms\|sleep\|exercise\|stress\|meal` | ë³µí•© | **ìˆ˜ì²œ** | ìˆ˜ë°±ë§Œ |
| **Lucky Exam** | `category\|date\|prep\|anxiety\|status\|timepoint` | ë³µí•©Ã—ë‚ ì§œ | **âˆ** | ë¬´í•œ |
| **Family** | `concern\|questions\|relationship` | 5Ã—NÃ—M | **ìˆ˜ë°±** | ìˆ˜ë§Œ |
| **Career Future** | `role\|goal\|time\|path\|skills` | ë³µí•© | **ìˆ˜ì²œ** | ìˆ˜ë°±ë§Œ |
| **Blind Date** | `partner\|place\|expectations` | í…ìŠ¤íŠ¸Â³ | **âˆ** | ë¬´í•œ |
| **Home Fengshui** | `address\|homeType\|floor\|doorDirection` | ë³µí•© | **âˆ** | ë¬´í•œ |

### 2.3 ë‚ ì§œ í¬í•¨ ì—¬ë¶€ ë¶„ì„

| ë‚ ì§œ ì œì™¸ (í’€ ëˆ„ì  ê°€ëŠ¥) | ë‚ ì§œ í¬í•¨ (ë§¤ì¼ ë¦¬ì…‹) |
|----------------------|-------------------|
| MBTI, Personality DNA, Biorhythm, Daily, Talent, Freelance, Family | E-sports, Lucky Exam, Startup, Career Seeker, Career Change, Tojeong, Salpuli |

---

## 3. API í˜¸ì¶œ í™•ë¥  ê³„ì‚°

### 3.1 ë‹¨ê³„ë³„ í†µê³¼ í™•ë¥ 

```
ìš”ì²­ 100íšŒ ê¸°ì¤€:

1ë‹¨ê³„ (ê°œì¸ ìºì‹œ)
â”œâ”€ íˆíŠ¸: 30íšŒ â†’ ì¦‰ì‹œ ë°˜í™˜ (API 0íšŒ)
â””â”€ ë¯¸ìŠ¤: 70íšŒ â†’ ë‹¤ìŒ ë‹¨ê³„

2ë‹¨ê³„ (DB í’€ 300ê°œ)
â”œâ”€ í’€ ì¶©ì¡±: 35íšŒ â†’ DB ëœë¤ (API 0íšŒ)
â””â”€ í’€ ë¯¸ë‹¬: 35íšŒ â†’ ë‹¤ìŒ ë‹¨ê³„

3ë‹¨ê³„ (30% ëœë¤)
â”œâ”€ ë‹¹ì²¨: 10íšŒ â†’ DB ëœë¤ (API 0íšŒ)
â””â”€ ë¯¸ë‹¹ì²¨: 25íšŒ â†’ ë‹¤ìŒ ë‹¨ê³„

4ë‹¨ê³„ (API í˜¸ì¶œ)
â””â”€ API í˜¸ì¶œ: 25íšŒ

ìµœì¢… API í˜¸ì¶œë¥ : 25/100 = 25%
(í’€ ì¶•ì  ì „ ì´ˆê¸°ì—ëŠ” ì•½ 28%)
```

### 3.2 í’€ ì¶•ì  ë‹¨ê³„ë³„ API í˜¸ì¶œë¥ 

| í’€ ìƒíƒœ | ê°œì¸ ìºì‹œ | DB í’€ | ëœë¤ | API í˜¸ì¶œë¥  |
|--------|----------|-------|------|----------|
| ì´ˆê¸° (0-50ê°œ) | 30% | 0% | 5% | **46%** |
| ì„±ì¥ (50-150ê°œ) | 30% | 10% | 15% | **32%** |
| ì¤‘ê°„ (150-250ê°œ) | 30% | 25% | 20% | **18%** |
| ì„±ìˆ™ (300ê°œ+) | 30% | 50% | 5% | **11%** |

---

## 4. ë¹„ìš© ì‹œë®¬ë ˆì´ì…˜

### 4.1 LLM API ë¹„ìš© ê¸°ì¤€

| ëª¨ë¸ | ì…ë ¥ (1M tokens) | ì¶œë ¥ (1M tokens) | í‰ê· /í˜¸ì¶œ (2K tokens) |
|------|-----------------|-----------------|---------------------|
| GPT-4o | $2.50 | $10.00 | $0.025 |
| GPT-4o-mini | $0.15 | $0.60 | $0.0015 |
| Claude 3.5 Sonnet | $3.00 | $15.00 | $0.036 |
| Gemini 1.5 Flash | $0.075 | $0.30 | $0.00075 |

### 4.2 ì›”ê°„ ë¹„ìš© ì˜ˆì¸¡ (DAU 1,000ëª…)

**ê°€ì •**:
- ì¼ì¼ ìš´ì„¸ ìš”ì²­: 5,000íšŒ (ì¸ë‹¹ 5íšŒ)
- í‰ê·  í† í°/í˜¸ì¶œ: 2,000
- ëª¨ë¸: GPT-4o-mini + GPT-4o í˜¼í•©

| í•­ëª© | í˜„ì¬ ì‹œìŠ¤í…œ | ìµœì í™” í›„ |
|------|-----------|----------|
| ì¼ì¼ ìš´ì„¸ ìš”ì²­ | 5,000íšŒ | 5,000íšŒ |
| API í˜¸ì¶œ ë¹„ìœ¨ | 28% | 15% |
| ì¼ì¼ API í˜¸ì¶œ | 1,400íšŒ | 750íšŒ |
| ì›”ê°„ API í˜¸ì¶œ | 42,000íšŒ | 22,500íšŒ |
| í‰ê·  ë¹„ìš©/í˜¸ì¶œ | $0.01 | $0.01 |
| **ì›”ê°„ ë¹„ìš©** | **$420** | **$225** |
| **ì ˆê°ì•¡** | - | **$195/ì›” (46%)** |

### 4.3 ì¸ì‚¬ì´íŠ¸ íƒ€ì…ë³„ ë¹„ìš© ë¹„ì¤‘

| ì¸ì‚¬ì´íŠ¸ | ì›”ê°„ í˜¸ì¶œ ë¹„ì¤‘ | ë¹„ìš© ë¹„ì¤‘ | ìµœì í™” ìš°ì„ ìˆœìœ„ |
|------|-------------|----------|--------------|
| Daily | 30% | 35% | ğŸ”´ ë†’ìŒ |
| Personality DNA | 15% | 18% | ğŸ”´ ë†’ìŒ |
| Love | 10% | 12% | ğŸŸ  ì¤‘ê°„ |
| MBTI | 20% | 15% | ğŸŸ¢ ì´ë¯¸ íš¨ìœ¨ |
| ê¸°íƒ€ | 25% | 20% | ğŸŸ¡ ê²€í†  í•„ìš” |

---

## 5. ìµœì í™” ê°œì„ ì•ˆ

### 5.1 Personality DNA (9,216 â†’ 1 ì¡°í•©)

**í˜„ì¬ ë¬¸ì œ**:
```dart
// 9,216ê°œ ì¡°í•© = 16 Ã— 4 Ã— 12 Ã— 12
return 'mbti:${mbti!.hashCode}|blood:${bloodType!.hashCode}|zodiac:${zodiac!.hashCode}|animal:${animal!.hashCode}';
```

**ê°œì„ ì•ˆ**:
```dart
// ì „ì²´ í†µí•© 1ê°œ ì¡°í•© â†’ 300ê°œ í›„ ì¦‰ì‹œ í’€ ì¬ì‚¬ìš©
return 'personality_dna';
```

**íš¨ê³¼**: 2,764,800íšŒ â†’ 300íšŒ (99.99% ê°ì†Œ)

### 5.2 Daily Fortune (âˆ â†’ 125 ì¡°í•©)

**í˜„ì¬ ë¬¸ì œ**:
```dart
// ì§ˆë¬¸ í•´ì‹œ í¬í•¨ â†’ ë¬´í•œ ì¡°í•©
if (question != null && question!.isNotEmpty) 'q:${question!.hashCode}',
```

**ê°œì„ ì•ˆ**:
```dart
// ì§ˆë¬¸ ì œì™¸ â†’ 5Ã—5Ã—5 = 125 ì¡°í•©
return 'period:${period.name}|category:${category?.name ?? "none"}|emotion:${emotion?.name ?? "none"}';
```

**íš¨ê³¼**: âˆ â†’ 37,500íšŒ (125 ì¡°í•© Ã— 300ê°œ)

### 5.3 ê¸°íƒ€ ì¸ì‚¬ì´íŠ¸ ê°œì„  ì œì•ˆ

| ìš´ì„¸ | í˜„ì¬ | ê°œì„ ì•ˆ | ì˜ˆìƒ íš¨ê³¼ |
|------|------|--------|----------|
| Dream | ê¿ˆë‚´ìš© í•´ì‹œ | í‚¤ì›Œë“œ ì¹´í…Œê³ ë¦¬í™” | 90% ê°ì†Œ |
| Face Reading | ì´ë¯¸ì§€ í•´ì‹œ | ì„±ë³„+ë‚˜ì´ ë²”ìœ„ë§Œ | 95% ê°ì†Œ |
| Love | 13ê°œ í•„ë“œ | í•µì‹¬ 3ê°œë§Œ | 80% ê°ì†Œ |
| Compatibility | ì´ë¦„+ìƒì¼ | ë +ë³„ìë¦¬ë§Œ | 99% ê°ì†Œ |

---

## 6. ëª¨ë‹ˆí„°ë§ ë©”íŠ¸ë¦­

### 6.1 ì¶”ì  ì§€í‘œ

```sql
-- ì¼ë³„ API í˜¸ì¶œ í†µê³„
SELECT
  date,
  fortune_type,
  COUNT(*) as total_requests,
  SUM(CASE WHEN api_call THEN 1 ELSE 0 END) as api_calls,
  ROUND(SUM(CASE WHEN api_call THEN 1 ELSE 0 END)::decimal / COUNT(*) * 100, 2) as api_rate
FROM fortune_results
WHERE date >= CURRENT_DATE - INTERVAL '7 days'
GROUP BY date, fortune_type
ORDER BY date DESC, api_calls DESC;
```

### 6.2 ì•Œë¦¼ ì„ê³„ê°’

| ì§€í‘œ | ì •ìƒ | ê²½ê³  | ìœ„í—˜ |
|------|------|------|------|
| API í˜¸ì¶œë¥  | < 20% | 20-35% | > 35% |
| í’€ ì„±ì¥ë¥  | > 10ê°œ/ì¼ | 5-10ê°œ/ì¼ | < 5ê°œ/ì¼ |
| ìºì‹œ íˆíŠ¸ìœ¨ | > 40% | 30-40% | < 30% |

---

## 7. ê´€ë ¨ íŒŒì¼

### 7.1 í•µì‹¬ ì„œë¹„ìŠ¤

- [fortune_optimization_service.dart](lib/core/services/fortune_optimization_service.dart) - 6ë‹¨ê³„ ìµœì í™” ë¡œì§
- [unified_fortune_service.dart](lib/core/services/unified_fortune_service.dart) - í†µí•© ìš´ì„¸ ì„œë¹„ìŠ¤

### 7.2 ìš´ì„¸ ì¡°ê±´ íŒŒì¼

- [personality_dna_fortune_conditions.dart](lib/features/fortune/domain/models/conditions/personality_dna_fortune_conditions.dart)
- [daily_fortune_conditions.dart](lib/features/fortune/domain/models/conditions/daily_fortune_conditions.dart)
- [love_fortune_conditions.dart](lib/features/fortune/domain/models/conditions/love_fortune_conditions.dart)
- ê¸°íƒ€ 26ê°œ ì¡°ê±´ íŒŒì¼

### 7.3 DB í…Œì´ë¸”

- `fortune_results` - ìºì‹œ ê²°ê³¼ ì €ì¥
- `fortune_history` - ì¡°íšŒ ì´ë ¥ ì €ì¥

---

## 8. ë²„ì „ íˆìŠ¤í† ë¦¬

| ë²„ì „ | ë‚ ì§œ | ë³€ê²½ ì‚¬í•­ |
|------|------|----------|
| 1.0 | 2025-12-20 | ì´ˆê¸° ë¬¸ì„œ ì‘ì„± |
| 2.0 | 2026-01-04 | Cohort Pool ì‹œìŠ¤í…œ ì¶”ê°€ (API 90% ì ˆê° ëª©í‘œ) |

---

## 9. Cohort Pool ì‚¬ìš©ë²•

### 9.1 Pool ë°°ì¹˜ ìƒì„±

```bash
# Daily ìš´ì„¸ cohort pool ìƒì„± (í•œ ë²ˆì— 10ê°œ cohort)
curl -X POST https://xxx.supabase.co/functions/v1/generate-cohort-pool \
  -H "Authorization: Bearer <SERVICE_ROLE_KEY>" \
  -d '{"fortuneType": "daily", "maxCohorts": 10}'
```

### 9.2 Pool í†µê³„ í™•ì¸

```sql
-- Cohortë³„ Pool í†µê³„
SELECT * FROM get_cohort_pool_stats('daily');

-- ë¶€ì¡±í•œ Cohort ëª©ë¡
SELECT * FROM get_underfilled_cohorts('daily', 25);
```

### 9.3 Flutterì—ì„œ Cohort ì‚¬ìš©

```dart
final cohortService = CohortFortuneService(supabase: Supabase.instance.client);

// Cohort Poolì—ì„œ ê²°ê³¼ ì¡°íšŒ ì‹œë„
final result = await cohortService.getFromCohortPool(
  fortuneType: 'daily',
  input: {
    'birthDate': '1990-01-01',
    'gender': 'male',
  },
);

if (result != null) {
  // Poolì—ì„œ ê²°ê³¼ ë°˜í™˜ë¨ (API í˜¸ì¶œ ì—†ìŒ)
  return result;
} else {
  // Pool ì—†ìŒ - ê¸°ì¡´ LLM í˜¸ì¶œ ë¡œì§
  return await callLlmApi(...);
}
```