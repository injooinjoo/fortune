# [3.6] 궁합 개선 기획서

## 1. 요구사항

| 항목 | 설명 | 복잡도 |
|------|------|--------|
| 3.6.1 | 상대방 정보 입력 시 등록된 프로필 선택 우선 | 중간 |

---

## 2. 현황 분석

### 2.1 현재 구현
- Person 1 (나의 정보): userProfileProvider에서 자동 채움
- Person 2 (상대방 정보): 수동 입력만 가능

### 2.2 관련 파일
```
lib/features/fortune/presentation/pages/compatibility/
├── compatibility_page.dart (메인 페이지)
└── widgets/
    └── compatibility_input_view.dart (입력 UI)

lib/presentation/providers/
└── secondary_profiles_provider.dart (서브 프로필 관리)

lib/data/models/
└── secondary_profile.dart (프로필 모델)
```

### 2.3 SecondaryProfile 모델
```dart
class SecondaryProfile {
  final String name;
  final String birthDate;  // YYYY-MM-DD 형식
  final String? birthTime;
  final String gender;
  final String? relationship;  // family/friend/other
  final int avatarIndex;

  DateTime? get birthDateTime => DateTime.parse(birthDate);
}
```

---

## 3. 구현 계획

### 3.6.1 프로필 선택 우선

**목표**: 상대방 정보 입력 시 등록된 프로필 목록을 먼저 보여주고 선택 가능

**UI 변경**:
```
┌─────────────────────────────────────┐
│  💕 상대방 정보                       │
├─────────────────────────────────────┤
│                                     │
│  ┌─────┐ ┌─────┐ ┌─────┐           │
│  │ 아빠 │ │ 엄마 │ │ 동생 │ ← 등록 프로필 │
│  └─────┘ └─────┘ └─────┘           │
│                                     │
│  ┌─────────────────────────────────┐ │
│  │  ➕ 직접 입력하기               │ │
│  └─────────────────────────────────┘ │
│                                     │
└─────────────────────────────────────┘
```

프로필 선택 시:
```
┌─────────────────────────────────────┐
│  💕 상대방 정보                       │
├─────────────────────────────────────┤
│  [아빠] ✓ 선택됨    [변경하기]       │
│                                     │
│  이름: 홍길동                        │
│  생년월일: 1960-05-15               │
│                                     │
└─────────────────────────────────────┘
```

**구현 방법**:

1. CompatibilityInputView를 ConsumerStatefulWidget으로 변경
2. secondaryProfilesProvider 연결
3. 프로필 선택 UI 추가:
   - 등록된 프로필 목록 (가로 스크롤 칩 형태)
   - "직접 입력하기" 옵션
4. 선택 시 name/birthDate 자동 채움
5. 선택 상태 관리 (selectedProfileId)

**파일 수정**:
- `compatibility_input_view.dart`: StatelessWidget → ConsumerStatefulWidget
- 프로필 선택 UI 추가 (Person 2 섹션에)

---

## 4. 체크리스트

- [ ] CompatibilityInputView를 ConsumerStatefulWidget으로 변경
- [ ] secondaryProfilesProvider import 추가
- [ ] 프로필 선택 UI 구현 (_buildProfileSelector)
- [ ] 선택된 프로필 상태 관리
- [ ] 프로필 선택 시 콜백 (onProfileSelected)
- [ ] compatibility_page.dart에서 프로필 선택 처리
- [ ] flutter analyze 검증

---

## 5. 예상 소요 시간

| 항목 | 예상 시간 |
|------|----------|
| 위젯 변환 및 Provider 연결 | 15분 |
| 프로필 선택 UI | 20분 |
| 상태 관리 연결 | 10분 |
| 테스트 | 5분 |
| **합계** | **50분** |

---
**작성일**: 2025-12-17