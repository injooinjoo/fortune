# [3.6] ê´€ìƒ ë‹®ì€ê¼´ ë¶„ì„ ê¸°ëŠ¥ ê¸°íšì„œ

## 1. ìš”êµ¬ì‚¬í•­

| í•­ëª© | ì„¤ëª… | ë³µì¡ë„ |
|------|------|--------|
| 3.6.1 | ê´€ìƒ ë¶„ì„ ê²°ê³¼ì— ë‹®ì€ê¼´ ìœ ëª…ì¸ ì¶”ê°€ | ë†’ìŒ |
| 3.6.2 | ìœ ì‚¬ë„ ì ìˆ˜ ë° ë‹®ì€ ë¶€ìœ„ í‘œì‹œ | ì¤‘ê°„ |

---

## 2. í˜„í™© ë¶„ì„

### 2.1 í˜„ì¬ êµ¬í˜„

**ê´€ìƒ í˜ì´ì§€ (face_reading_page.dart)**:
- ì‚¬ì§„ ì—…ë¡œë“œ â†’ ê´€ìƒ ë¶„ì„ â†’ í…ìŠ¤íŠ¸ ê²°ê³¼
- ë‹®ì€ê¼´ ë¶„ì„ ê¸°ëŠ¥ ì—†ìŒ
- ê²°ê³¼: ì´ë§ˆ, ëˆˆì¹, ëˆˆ, ì½”, ì…, ì „ì²´ ì¸ìƒ

**ê´€ìƒìš´ì„¸ í˜ì´ì§€ (face_reading_fortune)**:
- ì‚¬ì§„ ì—…ë¡œë“œ â†’ ìƒì„¸ ê´€ìƒ ë¶„ì„ â†’ ë‹®ì€ê¼´ ìœ ëª…ì¸ í¬í•¨
- `CelebrityMatchCarousel` ìœ„ì ¯ ì‚¬ìš©
- Edge Function: `similar_celebrities` ë°˜í™˜

### 2.2 ê´€ë ¨ íŒŒì¼
```
lib/features/interactive/presentation/pages/
â””â”€â”€ face_reading_page.dart (ëŒ€ìƒ í˜ì´ì§€)

lib/features/fortune/presentation/pages/face_reading_fortune/
â”œâ”€â”€ face_reading_result_page.dart (ì°¸ì¡° - ë‹®ì€ê¼´ í¬í•¨)
â””â”€â”€ widgets/
    â””â”€â”€ result_widget.dart

lib/features/fortune/presentation/widgets/face_reading/
â””â”€â”€ celebrity_match_carousel.dart (ì¬ì‚¬ìš© ê°€ëŠ¥)
```

### 2.3 CelebrityMatchCarousel ë°ì´í„° êµ¬ì¡°

```dart
// API ì‘ë‹µ ì˜ˆì‹œ
{
  "similar_celebrities": [
    {
      "celebrity_name": "ì•„ì´ìœ ",
      "celebrity_type": "solo_singer",
      "similarity_score": 87,
      "matched_features": ["ëˆˆë§¤", "ì›ƒëŠ” ëª¨ìŠµ", "ì´ëª©êµ¬ë¹„ ë¹„ìœ¨"],
      "character_image_url": "https://...",
      "reason": "ë§‘ê³  ë˜ë ·í•œ ëˆˆë§¤ê°€ ë§¤ìš° ìœ ì‚¬í•©ë‹ˆë‹¤"
    },
    // ...
  ]
}
```

### 2.4 í˜„ì¬ face_reading_page êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ê´€ìƒ                         [â†]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚    ë‹¹ì‹ ì˜ ì–¼êµ´ì„ ë¶„ì„í•©ë‹ˆë‹¤   â”‚    â”‚
â”‚  â”‚    5 ë³µì£¼ë¨¸ë‹ˆ í•„ìš”          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚      [ì‚¬ì§„ ì˜ì—­]            â”‚    â”‚
â”‚  â”‚                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚
â”‚  [ğŸ“· ì¹´ë©”ë¼] [ğŸ–¼ï¸ ê°¤ëŸ¬ë¦¬]           â”‚
â”‚                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€ ê²°ê³¼ (ë¶„ì„ í›„) â”€â”€â”€â”€â”€â”€      â”‚
â”‚  ã€ì´ë§ˆã€‘ ë„“ê³  ì‹œì›í•œ ì´ë§ˆëŠ”...      â”‚
â”‚  ã€ëˆˆì¹ã€‘ ì§™ê³  ì„ ëª…í•œ ëˆˆì¹ì€...      â”‚
â”‚  ã€ëˆˆã€‘ ë§‘ê³  ê¹Šì€ ëˆˆì€...           â”‚
â”‚  ã€ì½”ã€‘ ê· í˜• ì¡íŒ ì½”ëŠ”...           â”‚
â”‚  ã€ì…ã€‘ ë”°ëœ»í•œ ë¯¸ì†Œê°€...            â”‚
â”‚  ã€ì „ì²´ã€‘ ì „ë°˜ì ìœ¼ë¡œ...             â”‚
â”‚                                     â”‚
â”‚  [ë‹¤ì‹œ ë¶„ì„] [ê²°ê³¼ ê³µìœ ]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ê°œì„  ë°©í–¥

### 3.1 ëª©í‘œ

ê¸°ì¡´ ê´€ìƒ ê²°ê³¼ì— **ë‹®ì€ê¼´ ìœ ëª…ì¸ ì„¹ì…˜** ì¶”ê°€:
- CelebrityMatchCarousel ìœ„ì ¯ ì¬ì‚¬ìš©
- ìŠ¤ì™€ì´í”„ ê°€ëŠ¥í•œ ìºëŸ¬ì…€ í˜•íƒœ
- ìœ ì‚¬ë„ ì ìˆ˜, ë‹®ì€ ë¶€ìœ„, ì´ìœ  í‘œì‹œ

### 3.2 ê°œì„  UI ë ˆì´ì•„ì›ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ê´€ìƒ                         [â†]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ... (ê¸°ì¡´ ì…ë ¥/ì‚¬ì§„ ì˜ì—­)           â”‚
â”‚                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€ ê²°ê³¼ (ë¶„ì„ í›„) â”€â”€â”€â”€â”€â”€      â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€ ë‹®ì€ê¼´ ìœ ëª…ì¸ (NEW) â”€â”€â”        â”‚
â”‚  â”‚ â­ ë‹®ì€ê¼´ ìœ ëª…ì¸   1/3  â”‚        â”‚ â† ìºëŸ¬ì…€ í—¤ë”
â”‚  â”‚                         â”‚        â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚        â”‚
â”‚  â”‚ â”‚ [ğŸ†1] ì•„ì´ìœ         â”‚ â”‚        â”‚ â† ìºëŸ¬ì…€ ì¹´ë“œ
â”‚  â”‚ â”‚ ì†”ë¡œ ê°€ìˆ˜           â”‚ â”‚        â”‚
â”‚  â”‚ â”‚ â­ ìœ ì‚¬ë„ 87%       â”‚ â”‚        â”‚
â”‚  â”‚ â”‚ ëˆˆë§¤ | ì›ƒëŠ” ëª¨ìŠµ    â”‚ â”‚        â”‚
â”‚  â”‚ â”‚ "ë§‘ê³  ë˜ë ·í•œ..."    â”‚ â”‚        â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚        â”‚
â”‚  â”‚     â—‹ â— â—‹              â”‚        â”‚ â† ë„íŠ¸ ì¸ë””ì¼€ì´í„°
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                     â”‚
â”‚  ã€ì´ë§ˆã€‘ ë„“ê³  ì‹œì›í•œ ì´ë§ˆëŠ”...      â”‚
â”‚  ã€ëˆˆì¹ã€‘ ì§™ê³  ì„ ëª…í•œ ëˆˆì¹ì€...      â”‚
â”‚  ... (ê¸°ì¡´ ë¶„ì„ ê²°ê³¼)               â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. ìƒì„¸ êµ¬í˜„

### 4.1 Import ì¶”ê°€

```dart
// face_reading_page.dart
import '../../../fortune/presentation/widgets/face_reading/celebrity_match_carousel.dart';
```

### 4.2 ìƒíƒœ ë³€ìˆ˜ ì¶”ê°€

```dart
class _FaceReadingPageState extends ConsumerState<FaceReadingPage> {
  // ê¸°ì¡´ ë³€ìˆ˜ë“¤...
  String? _analysisResult;

  // âœ… ë‹®ì€ê¼´ ìœ ëª…ì¸ ë°ì´í„° ì¶”ê°€
  List<Map<String, dynamic>>? _similarCelebrities;
}
```

### 4.3 ë¶„ì„ API ìˆ˜ì •

í˜„ì¬ `_analyzeImage()`ëŠ” í•˜ë“œì½”ë”©ëœ ê²°ê³¼ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
ì‹¤ì œ API í˜¸ì¶œë¡œ ë³€ê²½í•˜ê±°ë‚˜, ë‹®ì€ê¼´ ë°ì´í„°ë„ í¬í•¨í•˜ë„ë¡ ìˆ˜ì •:

```dart
Future<void> _analyzeImage() async {
  // í† í° í™•ì¸...
  setState(() => _isAnalyzing = true);

  try {
    // TODO: ì‹¤ì œ API í˜¸ì¶œ
    // ì˜µì…˜ 1: ê¸°ì¡´ face-reading Edge Function í™•ì¥
    // ì˜µì…˜ 2: face-reading-fortune Edge Function ì‚¬ìš©

    final response = await UnifiedFortuneService(Supabase.instance.client)
        .getFortune(
          fortuneType: 'face-reading',
          inputConditions: {
            'imageBase64': base64Encode(await _selectedImage!.readAsBytes()),
            'includeCelebrityMatch': true, // ë‹®ì€ê¼´ ë¶„ì„ í¬í•¨
          },
        );

    // í† í° ì°¨ê°...

    setState(() {
      _analysisResult = _formatAnalysisResult(response);
      _similarCelebrities = (response.data['similar_celebrities'] as List?)
          ?.map((e) => e as Map<String, dynamic>)
          .toList();
      _isAnalyzing = false;
    });
  } catch (e) {
    // ì—ëŸ¬ ì²˜ë¦¬...
  }
}
```

### 4.4 ê²°ê³¼ ì„¹ì…˜ì— ìºëŸ¬ì…€ ì¶”ê°€

```dart
Widget _buildResultSection() {
  return GlassContainer(
    child: Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        // í—¤ë”
        Row(
          children: [
            Icon(Icons.psychology, color: Theme.of(context).colorScheme.primary),
            const SizedBox(width: 8),
            Text('ê´€ìƒ ë¶„ì„ ê²°ê³¼', style: headlineStyle),
          ],
        ),
        const SizedBox(height: 16),

        // âœ… ë‹®ì€ê¼´ ìœ ëª…ì¸ ìºëŸ¬ì…€ ì¶”ê°€
        if (_similarCelebrities != null && _similarCelebrities!.isNotEmpty) ...[
          CelebrityMatchCarousel(
            celebrities: _similarCelebrities!,
            isBlurred: false, // ë˜ëŠ” í”„ë¦¬ë¯¸ì—„ ìƒíƒœì— ë”°ë¼
          ),
          const SizedBox(height: 24),
        ],

        // ê¸°ì¡´ ë¶„ì„ ê²°ê³¼
        Text(
          _analysisResult!,
          style: bodyStyle,
        ),

        // ì•¡ì…˜ ë²„íŠ¼ë“¤...
      ],
    ),
  );
}
```

---

## 5. Edge Function ìˆ˜ì • (í•„ìš” ì‹œ)

### 5.1 face-reading Edge Function í™•ì¥

í˜„ì¬ `face-reading` Edge Functionì´ ë‹®ì€ê¼´ ë¶„ì„ì„ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´:

**ì˜µì…˜ A**: ê¸°ì¡´ í•¨ìˆ˜ í™•ì¥
```typescript
// supabase/functions/face-reading/index.ts

interface FaceReadingResponse {
  // ê¸°ì¡´ í•„ë“œë“¤...
  forehead: string;
  eyebrows: string;
  eyes: string;
  nose: string;
  mouth: string;
  overall: string;

  // âœ… ë‹®ì€ê¼´ ì¶”ê°€
  similar_celebrities?: {
    celebrity_name: string;
    celebrity_type: string;
    similarity_score: number;
    matched_features: string[];
    reason: string;
  }[];
}
```

**ì˜µì…˜ B**: face-reading-fortune í•¨ìˆ˜ ì¬ì‚¬ìš©
- ì´ë¯¸ ë‹®ì€ê¼´ ë¶„ì„ì´ êµ¬í˜„ëœ í•¨ìˆ˜ ì‚¬ìš©
- ë¶ˆí•„ìš”í•œ í•„ë“œ í•„í„°ë§

---

## 6. ì²´í¬ë¦¬ìŠ¤íŠ¸

### 6.1 í”„ë¡ íŠ¸ì—”ë“œ
- [ ] CelebrityMatchCarousel import ì¶”ê°€
- [ ] _similarCelebrities ìƒíƒœ ë³€ìˆ˜ ì¶”ê°€
- [ ] _analyzeImageì—ì„œ ë‹®ì€ê¼´ ë°ì´í„° íŒŒì‹±
- [ ] _buildResultSectionì— ìºëŸ¬ì…€ ì¶”ê°€
- [ ] ë¸”ëŸ¬ ì²˜ë¦¬ (í”„ë¦¬ë¯¸ì—„ ì „ìš© ì˜µì…˜)
- [ ] flutter analyze ê²€ì¦

### 6.2 ë°±ì—”ë“œ (í•„ìš” ì‹œ)
- [ ] face-reading Edge Function í™•ì¥
- [ ] ë‹®ì€ê¼´ ë¶„ì„ ë¡œì§ ì¶”ê°€
- [ ] ìœ ëª…ì¸ DB ì—°ë™

---

## 7. ì˜ˆìƒ ì†Œìš” ì‹œê°„

| í•­ëª© | ì˜ˆìƒ ì‹œê°„ |
|------|----------|
| Import ë° ìƒíƒœ ë³€ìˆ˜ ì¶”ê°€ | 10ë¶„ |
| _analyzeImage ìˆ˜ì • | 30ë¶„ |
| ê²°ê³¼ UIì— ìºëŸ¬ì…€ ì¶”ê°€ | 20ë¶„ |
| Edge Function ìˆ˜ì • (í•„ìš” ì‹œ) | 60ë¶„ |
| í…ŒìŠ¤íŠ¸ | 20ë¶„ |
| **í•©ê³„ (í”„ë¡ íŠ¸ë§Œ)** | **60ë¶„** |
| **í•©ê³„ (ë°±ì—”ë“œ í¬í•¨)** | **140ë¶„** |

---

## 8. ì•± ë‚´ ìœ ì‚¬ êµ¬í˜„ ì°¸ì¡°

### CelebrityMatchCarousel
```
lib/features/fortune/presentation/widgets/face_reading/celebrity_match_carousel.dart
```
- ìŠ¤ì™€ì´í”„ ê°€ëŠ¥í•œ ìºëŸ¬ì…€
- ìœ ëª…ì¸ ì¹´ë“œ UI
- íƒ€ì…ë³„ ìƒ‰ìƒ ì²˜ë¦¬
- ìˆœìœ„ ë°°ì§€

### FaceReadingResultPage
```
lib/features/fortune/presentation/pages/face_reading_fortune/face_reading_result_page.dart
```
- ë‹®ì€ê¼´ ìºëŸ¬ì…€ ì‚¬ìš© ì˜ˆì‹œ
- API ì‘ë‹µ íŒŒì‹± íŒ¨í„´

### CelebrityService
```
lib/services/celebrity_service.dart
```
- ìœ ëª…ì¸ ê²€ìƒ‰/ì¡°íšŒ ì„œë¹„ìŠ¤
- ì´ë¯¸ì§€ URL ê´€ë¦¬

---

## 9. ì¶”ê°€ ê³ ë ¤ì‚¬í•­

### 9.1 í”„ë¦¬ë¯¸ì—„ ê¸°ëŠ¥ ì—¬ë¶€
- ë‹®ì€ê¼´ ë¶„ì„ì„ í”„ë¦¬ë¯¸ì—„ ì „ìš©ìœ¼ë¡œ í•  ê²ƒì¸ì§€?
- ë˜ëŠ” 1ìœ„ë§Œ ë¬´ë£Œ, ë‚˜ë¨¸ì§€ ë¸”ëŸ¬ ì²˜ë¦¬?

### 9.2 ìœ ëª…ì¸ DB
- í˜„ì¬ ìœ ëª…ì¸ DBê°€ ì¶©ë¶„í•œì§€ í™•ì¸
- ë¶€ì¡±í•˜ë©´ celebrity_crawling_service í™œìš©

### 9.3 ì´ë¯¸ì§€ ì²˜ë¦¬
- ì–¼êµ´ ì¸ì‹ ì •í™•ë„
- ë¹„êµ ì•Œê³ ë¦¬ì¦˜ (AI ê¸°ë°˜)

---

**ì‘ì„±ì¼**: 2025-12-17