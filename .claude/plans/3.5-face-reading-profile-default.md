# [3.5] 관상 프로필사진 디폴트 설정 기획서

## 1. 요구사항

| 항목 | 설명 | 복잡도 |
|------|------|--------|
| 3.5.1 | 관상 시작 시 앱 프로필 사진을 기본값으로 표시 | 중간 |
| 3.5.2 | 프로필 사진 없으면 카메라/갤러리 선택 | 낮음 |

---

## 2. 현황 분석

### 2.1 현재 구현
- 관상 페이지: 사진 없이 시작 → 카메라/갤러리에서 직접 선택
- 프로필 사진: userProfileProvider에 저장되어 있음
- 이미지 업로드: ImagePicker 사용

### 2.2 관련 파일
```
lib/features/interactive/presentation/pages/
└── face_reading_page.dart (메인 페이지)

lib/presentation/providers/
└── user_profile_notifier.dart (프로필 Provider)

lib/data/models/
└── user_profile.dart (프로필 모델)
```

### 2.3 UserProfile 모델
```dart
class UserProfile {
  final String? name;
  final DateTime? birthDate;
  final String? photoUrl;  // ← 프로필 사진 URL
  // ...
}
```

### 2.4 현재 Face Reading 흐름
```
페이지 진입 → 광고 표시 → 사진 선택 화면 → 카메라/갤러리 → 분석
                         ↓
                    _selectedImage == null
```

---

## 3. 구현 계획

### 3.5.1 프로필 사진 기본값 설정

**목표**: 프로필 사진이 있으면 자동으로 기본값으로 설정

**UI 변경**:
```
프로필 사진 있는 경우:
┌─────────────────────────────────────┐
│           [프로필 사진]              │
│                                     │
│         ┌──────────────┐            │
│         │              │            │
│         │   👤 사진    │            │
│         │              │            │
│         └──────────────┘            │
│                                     │
│  [✓ 이 사진으로 분석] [다른 사진 선택] │
└─────────────────────────────────────┘

프로필 사진 없는 경우 (현재와 동일):
┌─────────────────────────────────────┐
│           [사진 선택]                │
│                                     │
│       📷 카메라  |  🖼️ 갤러리        │
└─────────────────────────────────────┘
```

**구현 방법**:

1. `face_reading_page.dart`에서 userProfileProvider 연결
2. initState에서 프로필 사진 URL 확인
3. 프로필 사진 있으면:
   - CachedNetworkImage로 표시
   - "이 사진으로 분석" 버튼 활성화
   - "다른 사진 선택" 옵션 제공
4. 프로필 사진 없으면 현재 로직 유지

**코드 변경**:
```dart
// face_reading_page.dart

@override
void initState() {
  super.initState();
  _showEntryAd();
  _loadProfilePhoto(); // 추가
}

Future<void> _loadProfilePhoto() async {
  final profile = ref.read(userProfileProvider).value;
  if (profile?.photoUrl != null && profile!.photoUrl!.isNotEmpty) {
    setState(() {
      _profilePhotoUrl = profile.photoUrl;
      _useProfilePhoto = true;
    });
  }
}
```

### 3.5.2 분석 시 이미지 처리

**기존**: `_selectedImage` (File) 사용
**변경**: 프로필 사진 URL 또는 로컬 파일 모두 지원

```dart
Future<void> _analyzeImage() async {
  File? imageToAnalyze;

  if (_useProfilePhoto && _profilePhotoUrl != null) {
    // 프로필 사진 URL을 임시 파일로 다운로드
    imageToAnalyze = await _downloadProfilePhoto(_profilePhotoUrl!);
  } else {
    imageToAnalyze = _selectedImage;
  }

  if (imageToAnalyze == null) return;

  // 기존 분석 로직...
}
```

---

## 4. 앱 내 유사 구현 참조

### InputStep1Widget (Face Reading Fortune)
```
lib/features/fortune/presentation/pages/face_reading_fortune/widgets/input_step1_widget.dart
```
- 프로필 사진 + 업로드 선택 UI 구현됨
- CachedNetworkImage 사용
- 카메라/갤러리 선택 로직

### 참고 패턴
```dart
// InputStep1Widget에서 프로필 사진 표시 방식
if (profilePhotoUrl != null && profilePhotoUrl.isNotEmpty)
  CachedNetworkImage(
    imageUrl: profilePhotoUrl,
    placeholder: (_, __) => CircularProgressIndicator(),
    errorWidget: (_, __, ___) => Icon(Icons.person),
  )
```

---

## 5. 체크리스트

- [ ] userProfileProvider import 추가
- [ ] _profilePhotoUrl, _useProfilePhoto 상태 추가
- [ ] initState에서 _loadProfilePhoto() 호출
- [ ] 프로필 사진 표시 UI 구현 (_buildProfilePhotoSection)
- [ ] "이 사진으로 분석" 버튼 추가
- [ ] "다른 사진 선택" 옵션 추가
- [ ] _analyzeImage에서 프로필 사진 처리 추가
- [ ] 이미지 다운로드 유틸리티 함수 추가
- [ ] flutter analyze 검증

---

## 6. 예상 소요 시간

| 항목 | 예상 시간 |
|------|----------|
| Provider 연결 | 10분 |
| 프로필 사진 UI | 20분 |
| 분석 로직 수정 | 15분 |
| 이미지 다운로드 처리 | 15분 |
| 테스트 | 10분 |
| **합계** | **70분** |

---

## 7. 의존성

- `cached_network_image` 패키지 (이미 사용 중)
- `path_provider` 패키지 (임시 파일 저장용, 이미 사용 중)
- `http` 패키지 (이미지 다운로드용)

---

**작성일**: 2025-12-17