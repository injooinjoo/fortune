# [3.3] ê´€ìƒ ì¶”ê°€ ê°œì„  ê¸°íšì„œ

## 1. ìš”êµ¬ì‚¬í•­

| í•­ëª© | ì„¤ëª… | ë³µì¡ë„ |
|------|------|--------|
| 3.3.1 | ì‹œì‘ ì‹œ ê´‘ê³  ì‚½ì… | ë‚®ìŒ |
| 3.3.2 | í”„ë¡œí•„ ì‚¬ì§„ ìë™ ì„¸íŒ… | ì¤‘ê°„ |
| 3.3.3 | ë‹®ì€ê¼´ ë¶„ì„ ê¸°ëŠ¥ ì¶”ê°€ | ë†’ìŒ |

---

## 2. í˜„í™© ë¶„ì„

### 2.1 í˜„ì¬ íŒŒì¼ êµ¬ì¡°
```
lib/features/fortune/presentation/pages/
â”œâ”€â”€ face_reading_fortune_page.dart (ë©”ì¸ í˜ì´ì§€)
â””â”€â”€ face_reading_fortune/
    â”œâ”€â”€ index.dart
    â”œâ”€â”€ face_reading_result_page.dart
    â””â”€â”€ widgets/
        â”œâ”€â”€ input_step1_widget.dart (ì‚¬ì§„ ì—…ë¡œë“œ)
        â”œâ”€â”€ input_step2_widget.dart (ë¶„ì„ ì‹œì‘)
        â”œâ”€â”€ result_widget.dart
        â”œâ”€â”€ ogwan_section_widget.dart
        â””â”€â”€ fortune_section_widget.dart
```

### 2.2 í˜„ì¬ Flow
1. InputStep1: ì‚¬ì§„ ì—…ë¡œë“œ (ì¹´ë©”ë¼/ê°¤ëŸ¬ë¦¬/ì¸ìŠ¤íƒ€ê·¸ë¨)
2. InputStep2: ë¶„ì„ ì‹œì‘ ë²„íŠ¼
3. Result: ê´€ìƒ ë¶„ì„ ê²°ê³¼ í‘œì‹œ

### 2.3 í”„ë¡œí•„ ì´ë¯¸ì§€ ë°ì´í„°
- `UserProfile.profileImageUrl`: ì†Œì…œ ë¡œê·¸ì¸ ì‹œ ê°€ì ¸ì˜¨ í”„ë¡œí•„ ì´ë¯¸ì§€ URL
- ì €ì¥ ìœ„ì¹˜: Supabase user_profiles í…Œì´ë¸”

---

## 3. êµ¬í˜„ ê³„íš

### 3.3.1 ì‹œì‘ ì‹œ ê´‘ê³  ì‚½ì… (ë‚®ìŒ ë³µì¡ë„)

**ëª©í‘œ**: ê´€ìƒ í˜ì´ì§€ ì§„ì… ì‹œ ì „ë©´ ê´‘ê³  í‘œì‹œ

**êµ¬í˜„ ë°©ë²•**:
```dart
// face_reading_fortune_page.dart
@override
void initState() {
  super.initState();
  _showEntryAd();
}

Future<void> _showEntryAd() async {
  final isPremium = ref.read(isPremiumProvider);
  if (isPremium) return; // í”„ë¦¬ë¯¸ì—„ ì‚¬ìš©ì ì œì™¸

  final adService = AdService();
  if (adService.isInterstitialAdReady) {
    await adService.showInterstitialAd();
  }
}
```

**ì¡°ê±´**:
- í”„ë¦¬ë¯¸ì—„ êµ¬ë…ì ì œì™¸
- í•˜ë£¨ 1íšŒ ì œí•œ (SharedPreferencesë¡œ ê´€ë¦¬)

**íŒŒì¼ ìˆ˜ì •**:
- `face_reading_fortune_page.dart`: initStateì— ê´‘ê³  ë¡œì§ ì¶”ê°€

---

### 3.3.2 í”„ë¡œí•„ ì‚¬ì§„ ìë™ ì„¸íŒ… (ì¤‘ê°„ ë³µì¡ë„)

**ëª©í‘œ**: í”„ë¡œí•„ ì‚¬ì§„ì´ ìˆëŠ” ê²½ìš° "ë‚´ í”„ë¡œí•„ ì‚¬ì§„ ì‚¬ìš©" ì˜µì…˜ ì œê³µ

**êµ¬í˜„ ë°©ë²•**:

1. **InputStep1Widget ìˆ˜ì •**:
```dart
class InputStep1Widget extends ConsumerWidget {
  // ...

  Widget build(BuildContext context, WidgetRef ref) {
    final userProfile = ref.watch(userProfileProvider).value;
    final hasProfileImage = userProfile?.profileImageUrl != null;

    return Column(
      children: [
        // í”„ë¡œí•„ ì‚¬ì§„ ì˜µì…˜ (ìˆëŠ” ê²½ìš°ë§Œ)
        if (hasProfileImage)
          _buildProfileImageOption(userProfile!.profileImageUrl!),

        // ê¸°ì¡´ ì—…ë¡œë“œ ì„¹ì…˜
        _buildUploadSection(),
      ],
    );
  }

  Widget _buildProfileImageOption(String imageUrl) {
    return GestureDetector(
      onTap: () => _useProfileImage(imageUrl),
      child: Container(
        // í”„ë¡œí•„ ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸° + "ë‚´ í”„ë¡œí•„ ì‚¬ì§„ ì‚¬ìš©" ë²„íŠ¼
      ),
    );
  }
}
```

2. **ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì²˜ë¦¬**:
```dart
Future<File?> _downloadProfileImage(String url) async {
  final response = await http.get(Uri.parse(url));
  final tempDir = await getTemporaryDirectory();
  final file = File('${tempDir.path}/profile_face.jpg');
  await file.writeAsBytes(response.bodyBytes);
  return file;
}
```

**íŒŒì¼ ìˆ˜ì •**:
- `input_step1_widget.dart`: StatelessWidget â†’ ConsumerWidget
- Provider ì˜ì¡´ì„± ì¶”ê°€

**UI ë””ìì¸**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [í”„ë¡œí•„ ì‚¬ì§„]  ë‚´ í”„ë¡œí•„ ì‚¬ì§„ ì‚¬ìš©    â”‚
â”‚     ğŸ‘¤         íƒ­í•˜ì—¬ ì„ íƒ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”€â”€â”€â”€ ë˜ëŠ” â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ì‚¬ì§„ ì—…ë¡œë“œ (ê¸°ì¡´ UI)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3.3.3 ë‹®ì€ê¼´ ë¶„ì„ ê¸°ëŠ¥ (ë†’ìŒ ë³µì¡ë„)

**í˜„ì‹¤ì  í‰ê°€**: ì´ ê¸°ëŠ¥ì€ ë³„ë„ ê¸°íšì´ í•„ìš”í•œ ëŒ€ê·œëª¨ ê¸°ëŠ¥

**í•„ìš” ìš”ì†Œ**:
1. **ì–¼êµ´ ì¸ì‹ API**
   - AWS Rekognition / Google Vision / Azure Face API
   - ë˜ëŠ” ìì²´ ML ëª¨ë¸

2. **ì—°ì˜ˆì¸ ì–¼êµ´ ë°ì´í„°ë² ì´ìŠ¤**
   - celebrities í…Œì´ë¸”ì— face_encoding ì»¬ëŸ¼ ì¶”ê°€
   - ë˜ëŠ” ë³„ë„ face_vectors í…Œì´ë¸”

3. **ìœ ì‚¬ë„ ë¹„êµ ì•Œê³ ë¦¬ì¦˜**
   - Cosine similarity
   - Euclidean distance

**ì œì•ˆ**:
- í˜„ì¬ ìŠ¤í”„ë¦°íŠ¸ì—ì„œëŠ” **ë³´ë¥˜**
- ë³„ë„ ê¸°íšì„œë¡œ ë¶„ë¦¬í•˜ì—¬ í–¥í›„ êµ¬í˜„

---

## 4. êµ¬í˜„ ìˆœì„œ (ì´ë²ˆ ìŠ¤í”„ë¦°íŠ¸)

### Phase 1: ê¸°ë³¸ ê°œì„  (êµ¬í˜„)
- [x] AI ë¬¸êµ¬ ì œê±° (ì´ì „ ì„¸ì…˜ì—ì„œ ì™„ë£Œ)
- [ ] 3.3.1 ì‹œì‘ ì‹œ ê´‘ê³  ì‚½ì…
- [ ] 3.3.2 í”„ë¡œí•„ ì‚¬ì§„ ìë™ ì„¸íŒ…

### Phase 2: í–¥í›„ ê³„íš (ë³´ë¥˜)
- [ ] 3.3.3 ë‹®ì€ê¼´ ë¶„ì„ ê¸°ëŠ¥ (ë³„ë„ ê¸°íš í•„ìš”)

---

## 5. ì²´í¬ë¦¬ìŠ¤íŠ¸

### 3.3.1 ê´‘ê³  ì‚½ì…
- [ ] face_reading_fortune_page.dartì— initState ìˆ˜ì •
- [ ] ì „ë©´ ê´‘ê³  í‘œì‹œ ë¡œì§ ì¶”ê°€
- [ ] í”„ë¦¬ë¯¸ì—„ ì‚¬ìš©ì ì œì™¸ ì²˜ë¦¬
- [ ] í•˜ë£¨ 1íšŒ ì œí•œ ë¡œì§ (ì„ íƒì‚¬í•­)

### 3.3.2 í”„ë¡œí•„ ì‚¬ì§„ ì˜µì…˜
- [ ] InputStep1Widgetì„ ConsumerWidgetìœ¼ë¡œ ë³€ê²½
- [ ] userProfileProviderì—ì„œ profileImageUrl ê°€ì ¸ì˜¤ê¸°
- [ ] í”„ë¡œí•„ ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸° UI ì¶”ê°€
- [ ] URL â†’ File ë‹¤ìš´ë¡œë“œ ë¡œì§
- [ ] onImageSelected ì½œë°± ì—°ê²°

---

## 6. ì˜ˆìƒ ì†Œìš” ì‹œê°„

| í•­ëª© | ì˜ˆìƒ ì‹œê°„ |
|------|----------|
| 3.3.1 ê´‘ê³  ì‚½ì… | 15ë¶„ |
| 3.3.2 í”„ë¡œí•„ ì‚¬ì§„ | 30ë¶„ |
| í…ŒìŠ¤íŠ¸ | 15ë¶„ |
| **í•©ê³„** | **60ë¶„** |

---
**ì‘ì„±ì¼**: 2025-12-17